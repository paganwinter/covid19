<html>
<head>
<title></title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial;
}
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.5.0/Chart.min.js"></script>
</head>
<body>

<canvas id="daily-new" width="800" height="300"></canvas>
<canvas id="daily-change" width="800" height="300"></canvas>
Powered by <a href="https://www.covid19india.org">https://www.covid19india.org</a><br />
More graphs at <a href="https://aatishb.com/covidtrends">https://aatishb.com/covidtrends</a>

<script>
const chartOpts = {
  legend: { display: false },
  scales: {
    yAxes: [ { position: 'right' } ],
    xAxes: [
      {
        gridLines: {
          display: false
        },
        ticks: {
          maxRotation: 90,
          minRotation: 90,
          autoSkip: true,
          maxTicksLimit: 50,
        },
      },
    ],
  },
}

async function main() {
  let res = await fetch('https://raw.githubusercontent.com/covid19india/api/master/data.json')
  let data = await res.json()
  console.log(data)

  let cases = data.cases_time_series
  let yesterdays = cases[cases.length - 1]
  let todays = data.key_values[0]
  let todaysDate = todays.lastupdatedtime.split('/') // 29/03/2020 18:17:23
  const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December' ]
  cases.push({
    dailyconfirmed: todays.confirmeddelta,
    dailyrecovered: todays.recovereddelta,
    dailydeceased: todays.deceaseddelta,
    date: `${todaysDate[0]} ${months[todaysDate[1] - 1]} `, // '29 March ',
    totalconfirmed: String(Number(yesterdays.totalconfirmed) + Number(todays.confirmeddelta)),
    totalrecovered: String(Number(yesterdays.totalrecovered) + Number(todays.recovereddelta)),
    totaldeceased: String(Number(yesterdays.totaldeceased) + Number(todays.deceaseddelta)),
  })

  let prevConfirm = 0
  for (let day of cases) {
    day.changeConfirmed = (day.dailyconfirmed - prevConfirm)
    console.log(day)
    console.log(day.dailyconfirmed, (day.dailyconfirmed - prevConfirm))
    prevConfirm = day.dailyconfirmed
  }
  console.log(cases)

  // daily-new
  new Chart(document.getElementById("daily-new"), {
    type: 'bar',
    data: {
      labels: cases.map(c => c.date.substr(0, 6)),
      datasets: [
        {
          label: "New cases",
          data: cases.map(c => c.dailyconfirmed),
          backgroundColor: "#002244",
          barPercentage: 0.1,
          // barThickness: 6,
          // maxBarThickness: 10,
        }
      ]
    },
    options: { ...chartOpts, title: { display: true, text: 'Daily New Confirmed Cases' } }
  });

  // daily-change
  new Chart(document.getElementById("daily-change"), {
    type: 'bar',
    data: {
      labels: cases.map(c => c.date),
      datasets: [
        {
          label: "Change in cases",
          backgroundColor: "#002244",
          data: cases.map(c => c.changeConfirmed),
        }
      ]
    },
    options: { ...chartOpts, title: { display: true, text: 'Change in New Confirmed Cases' } }
  });
}

window.onload = function () {
  main()
}

</script>
</body>
</html>